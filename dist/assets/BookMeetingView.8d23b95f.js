import{u as be,k as ye,A as ge,j as m,z as $,q as ke,r as D,B as he,o as s,g as w,w as n,d as o,b as c,c as i,t as v,n as d,F as z,C as Y,m as Z,l as we,G as xe,v as Ce,e as Ve,p as Pe}from"./index.8cdfa475.js";import{T as Se,A as Ae}from"./AttendeesComponent.3f960fe4.js";import{C as Ue}from"./component.a34915a3.js";import"./pdfjs.7adb8c57.js";const $e={id:"add-form",action:"javascript:void(0)",method:"post"},De={class:"d-flex flex-column align-items-start"},Me={class:"w-100",id:"v-pills-tabContent"},je={class:"fade active show m-5",id:"-3"},Be={key:0,class:"error","aria-live":"polite"},Te={class:"position-relative d-flex flex-column"},Ne={key:3,class:"text-muted mt-2"},Fe=["onClick"],Le={key:0,class:"error","aria-live":"polite"},Ie={key:0,class:"error","aria-live":"polite"},Oe={class:"position-relative d-flex flex-column"},Ee={key:3,class:"text-muted mt-2"},Re=["onClick"],ze={key:0,class:"error","aria-live":"polite"},Ye={class:"position-relative d-flex flex-column"},qe=["onClick"],Ge={key:0,class:"error","aria-live":"polite"},We={class:"file-input-container position-relative d-flex align-items-center"},He={key:0,class:"text-primary"},Je={key:1,class:"error","aria-live":"polite"},Ke={key:0,class:"error","aria-live":"polite"},Xe={key:0,class:"error","aria-live":"polite"},Ze={key:0,class:"error","aria-live":"polite"},Qe={key:0,class:"error","aria-live":"polite"},ea={key:0,class:"error","aria-live":"polite"},aa={key:0,class:"error","aria-live":"polite"},ta={class:"modal-footer border-0 d-flex justify-content-center w-100"},la={key:1,class:"btn btn-primary",type:"button",disabled:""},oa={__name:"BookAppointment",setup(Q){const q=be(),M=ye(),P=ge(),{proxy:k}=Pe(),y=m("");y.value=M.getRole();const x=m(""),j=m([]),G=m(0),I=m(!1),ee=()=>{u.value={}},B=m(""),u=m({}),T=m(!1),O=m([]),W=m([]),N=m(null),ae={dateFormat:"Y-m-d",altInput:!0,altFormat:"F j, Y",minDate:"today",disable:[function(a){return a.getDay()===6||a.getDay()===0}]},te=m(new Date().toLocaleDateString()),C=m(null);x.value=M.getUserId();const E=m({user_id:x,date:""}),le={user_id:x.value,appointment_date:N.value,start_time:"",end_time:"",contact_name:"",email_address:"",mobile_number:"",subject:"",description:"",appointment_type_id:"",space_id:C.value,file:null,attendees:""},r=m({...le}),oe=a=>{const e=a.target.files[0];e&&(r.value.file=e,S.value=e.name)},S=m(null),H=m(null),se=()=>{r.value.file=null,S.value=null,H.value.value=""},re=a=>{r.value.appointment_date=a,E.value.date=a,J()};$(N,a=>{a&&re(a)});const ne=a=>{O.value=a},ue=a=>{r.value.start_time=(a==null?void 0:a.startTime)||"",r.value.end_time=(a==null?void 0:a.endTime)||""},ie=async()=>{var a;try{const e=await P.get("/v1/scheduler/spaces");Array.isArray(e.data.dataPayload.data)&&(j.value=e.data.dataPayload.data)}catch(e){if(e.response&&e.response.data&&e.response.data.errorPayload)u.value=e.response.data.errorPayload.errors;else{const t=((a=e.response.data.errorPayload.errors)==null?void 0:a.message)||"An error occurred";k.$showToast({title:t,text:t,icon:"error"})}}},J=async()=>{var a,e;try{const t=await P.post("/v1/scheduler/get-slots",E.value);W.value=t.data.dataPayload.data.slots;const p=W.value.map(f=>({...f,selected:!1}));O.value=p}catch(t){if(t.response&&t.response.data.errorPayload)u.value=t.response.data.errorPayload.errors;else{const p=((e=(a=t==null?void 0:t.response)==null?void 0:a.data.errorPayload.errors)==null?void 0:e.message)||"An error occurred";k.$showToast({title:p,text:p,icon:"error"})}}},de=async()=>{var e;ee(),I.value=!0,G.value=0;const a=new FormData;a.append("file",r.value.file),Object.keys(r.value).forEach(t=>{t!=="file"&&a.append(t,r.value[t])});try{const t=await P.post("/v1/scheduler/appointments",a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:p=>{p.total&&(G.value=Math.round(p.loaded/p.total*100))}});t.data.toastPayload?(B.value=t.data.toastPayload,k.$showAlert({title:B.value.toastTheme||"Success",icon:B.value.toastTheme||"success",text:B.value.toastMessage||"Appointment created successfully",timer:4e3,showConfirmButton:!1,showCancelButton:!1,showprogressBar:!0}),q.push({name:"home"})):k.$showToast({title:"Success",icon:"success"}),r.value={}}catch(t){t.response&&t.response.status===422&&t.response.data.errorPayload&&(u.value=t.response.data.errorPayload.errors,t.response.data.errorPayload.errors.message&&k.$showAlert({title:(e=t.response.data.errorPayload.errors)==null?void 0:e.message,icon:"error",showCancelButton:!1,showConfirmButton:!1,timer:4e3}))}finally{I.value=!1}},R=m([]),K=async()=>{try{const a=await P.get("/v1/scheduler/meeting-types");R.value=a.data.dataPayload.data}catch(a){me(a)}},me=a=>{var e,t,p;if(a.response&&a.response.data&&a.response.data.errorPayload)u.value=a.response.data.errorPayload.errors;else{const f=((p=(t=(e=a.response.data)==null?void 0:e.errorPayload)==null?void 0:t.errors)==null?void 0:p.message)||"An unknown error occurred";k.$showToast({title:f,text:f,icon:"error"})}},F=m([]),h=m(""),pe=async()=>{var a;try{const e=await P.get("/v1/auth/users");Array.isArray(e.data.dataPayload.data)&&(F.value=e.data.dataPayload.data)}catch(e){if(e.response&&e.response.data&&e.response.data.errorPayload)u.value=e.response.data.errorPayload.errors;else{const t=((a=e.response.data.errorPayload.errors)==null?void 0:a.message)||"An unknown error occurred";k.$showToast({title:t,text:t,icon:"error"})}}},ce=a=>{r.value.attendees=a},A=m(""),g=m([]);$(A,a=>{if(a===""){g.value=[];return}g.value=j.value.filter(e=>e.name.toLowerCase().includes(a.toLowerCase()))}),$(C,a=>{const e=j.value.find(t=>t.name===a);r.value.space_id=e?e.id:null});const U=m(null),_=m([]);_.value=F.value,$(U,a=>{if(!a){_.value=[];return}_.value=F.value.filter(e=>e.username.toLowerCase().includes(a.toLowerCase())||e.email.toLowerCase().includes(a.toLowerCase())||e.fullname.toLowerCase().includes(a.toLowerCase()))});const V=m(null),ve=a=>{V.value=_.value.find(e=>e.id===a).fullname,h.value=a,_.value=[]};$(h,a=>{x.value=a||M.getUserId(),r.value.user_id=x.value,r.value.appointment_date&&J()});const L=m("");return ke(()=>{E.value.date=te.value,ie(),K(),K(),pe(),u.value={}}),(a,e)=>{const t=D("b-col"),p=D("b-row"),f=D("b-form-input"),b=D("b-form-group"),fe=D("b-card"),_e=he("b-tooltip");return s(),w(fe,null,{default:n(()=>[o(p,{class:"mb-4 myheading"},{default:n(()=>[o(t,{lg:"12",class:"d-flex justify-content-left"},{default:n(()=>e[20]||(e[20]=[c("div",null,[c("h2",null,"New Meeting")],-1)])),_:1})]),_:1}),c("form",$e,[c("div",De,[e[25]||(e[25]=c("input",{type:"hidden",name:"id"},null,-1)),e[26]||(e[26]=c("input",{type:"hidden",name:"appointment_type_id"},null,-1)),c("div",Me,[c("div",je,[o(p,{class:"align-items-center form-group"},{default:n(()=>[o(t,{cols:"12",lg:"12",class:"mb-sm-3 mb-md-3 mb-lg-0"},{default:n(()=>[o(b,{label:"Subject:","label-for":"input-1"},{default:n(()=>[o(f,{type:"text",id:"subject",modelValue:r.value.subject,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.subject=l),class:"form-control",placeholder:"what the meeting is about"},null,8,["modelValue"]),u.value.subject?(s(),i("div",Be,v(u.value.subject),1)):d("",!0)]),_:1})]),_:1})]),_:1}),o(p,{class:"align-items-center form-group"},{default:n(()=>[y.value==="su"||y.value==="secretary"?(s(),w(t,{key:0,cols:"12",lg:"4",class:"mb-4 mb-sm-3 mb-md-3 mb-lg-0"},{default:n(()=>[o(b,{label:"ChairPerson:","label-for":"input-1"},{default:n(()=>[c("div",Te,[h.value?d("",!0):(s(),w(f,{key:0,modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=l=>U.value=l),placeholder:"Search User...",class:"mb-2",onClick:e[2]||(e[2]=l=>_.value=F.value)},null,8,["modelValue"])),h.value?(s(),w(f,{key:1,modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=l=>V.value=l),placeholder:"Search User...",class:"mb-2",readonly:""},null,8,["modelValue"])):d("",!0),h.value?(s(),i("span",{key:2,class:"xuser",onClick:e[4]||(e[4]=l=>{V.value="",h.value="",x.value=""})},e[21]||(e[21]=[c("i",{class:"fas fa-times"},null,-1)]))):d("",!0),!h.value&&U.value&&!_.value.length?(s(),i("p",Ne,"No results found.")):d("",!0),_.value.length?(s(),i("ul",{key:4,class:"mt-5 userlistul list-group position-absolute w-100 bg-white border rounded shadow",role:"listbox",style:{"max-height":"160px","overflow-y":"auto"},onMouseleave:e[5]||(e[5]=l=>{_.value=[],U.value=""})},[(s(!0),i(z,null,Y(_.value,l=>(s(),i("li",{key:l.id,class:"list-group-item list-group-item-action",onClick:X=>ve(l.id)},v(l.fullname),9,Fe))),128))],32)):d("",!0)])]),_:1}),u.value.user_id?(s(),i("div",Le,v(u.value.user_id),1)):d("",!0)]),_:1})):d("",!0),o(t,{cols:"12",lg:y.value==="user"||y.value==="registrar"?6:4,class:"mb-sm-3 mb-md-3 mb-lg-0"},{default:n(()=>[o(b,{label:"Date:","label-for":"input-1"},{default:n(()=>[Z(o(we(Ue),{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=l=>N.value=l),class:"form-control",config:ae,id:"datePicker",disabled:!V.value&&y.value==="su"},null,8,["modelValue","disabled"]),[[_e,{title:"Chair must be selected",disabled:!!V.value},void 0,{hover:!0}]])]),_:1}),u.value.appointment_date?(s(),i("div",Ie,v(u.value.appointment_date),1)):d("",!0)]),_:1},8,["lg"]),o(t,{cols:"12",lg:y.value==="user"||y.value==="registrar"?6:4,class:"mb-4 mb-lg-0"},{default:n(()=>[o(b,{label:"Venue:","label-for":"space"},{default:n(()=>[c("div",Oe,[r.value.space_id===null?(s(),w(f,{key:0,modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=l=>A.value=l),placeholder:"Search venue ...",class:"mb-2",onClick:e[8]||(e[8]=l=>g.value=j.value)},null,8,["modelValue"])):d("",!0),r.value.space_id!==null?(s(),w(f,{key:1,modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=l=>C.value=l),placeholder:"Search Space...",class:"mb-2",readonly:""},null,8,["modelValue"])):d("",!0),r.value.space_id?(s(),i("span",{key:2,class:"clear-btn",onClick:e[10]||(e[10]=l=>{r.value.space_id="",C.value="",g.value=[]})},e[22]||(e[22]=[c("i",{class:"fas fa-times"},null,-1)]))):d("",!0),A.value&&g.value.length===0?(s(),i("p",Ee,"No venues available.")):d("",!0),g.value.length>0&&r.value.space_id===null?(s(),i("ul",{key:4,class:"userlistul mt-5 list-group position-absolute w-100 bg-white border rounded shadow",role:"listbox",style:{"max-height":"160px","overflow-y":"auto"},onMouseleave:e[11]||(e[11]=l=>{g.value=[],A.value=""})},[(s(!0),i(z,null,Y(g.value,l=>(s(),i("li",{class:xe([{disabled:l.is_locked},"list-group-item list-group-item-action"]),key:l.id,onClick:X=>{r.value.space_id=l.id,C.value=l.name}},v(l.name),11,Re))),128))],32)):d("",!0)])]),_:1}),u.value.space_id?(s(),i("div",ze,v(u.value.space_id),1)):d("",!0)]),_:1},8,["lg"])]),_:1}),o(p,{class:"align-items-center form-group"},{default:n(()=>[o(t,{cols:"12",lg:"6",class:"mb-sm-3 mb-md-3 mb-lg-0 mb-4"},{default:n(()=>[o(b,{label:"Meeting Type:","label-for":"input-1"},{default:n(()=>[c("div",Ye,[o(f,{modelValue:L.value,"onUpdate:modelValue":e[12]||(e[12]=l=>L.value=l),placeholder:"Meeting Type",onFocus:e[13]||(e[13]=l=>T.value=!0)},null,8,["modelValue"]),R.value.length&&T.value?(s(),i("ul",{key:0,class:"list-group position-relative",role:"listbox",style:{"max-height":"160px","overflow-y":"auto"},onMouseleave:e[14]||(e[14]=l=>T.value=!1)},[(s(!0),i(z,null,Y(R.value,l=>(s(),i("li",{key:l,class:"list-group-item list-group-item-action",onClick:X=>{r.value.appointment_type_id=l.id,L.value=l.type,T.value=!1}},v(l.type),9,qe))),128))],32)):d("",!0),r.value.appointment_type_id?(s(),i("span",{key:1,class:"clear-btn",onClick:e[15]||(e[15]=l=>{r.value.appointment_type_id="",L.value=""})},e[23]||(e[23]=[c("i",{class:"fas fa-times"},null,-1)]))):d("",!0)])]),_:1}),u.value.appointment_type_id?(s(),i("div",Ge,v(u.value.appointment_type_id),1)):d("",!0)]),_:1}),o(t,{cols:"12",lg:"6",class:"mb-sm-3 mb-md-3 mb-lg-0"},{default:n(()=>[o(b,{label:"Agenda:","label-for":"input-1"},{default:n(()=>[c("div",We,[c("input",{type:"file",class:"form-control",id:"fileUpload",onChange:oe,"aria-label":"Small file input",ref_key:"fileInput",ref:H},null,544),S.value?(s(),i("span",{key:0,class:"clear-file ms-2",onClick:se},e[24]||(e[24]=[c("i",{class:"fas fa-times"},null,-1)]))):d("",!0)]),S.value?(s(),i("p",He,v(S.value),1)):d("",!0),u.value.uploadedFile?(s(),i("div",Je,v(u.value.uploadedFile),1)):d("",!0)]),_:1})]),_:1})]),_:1}),o(p,{class:"g-3 align-items-center form-group"},{default:n(()=>[o(p,null,{default:n(()=>[o(t,{md:"12",lg:"12",sm:"12"},{default:n(()=>[o(Se,{timeSlots:O.value,"onUpdate:timeSlots":ne,onSelectedSlotsTimes:ue},null,8,["timeSlots"])]),_:1})]),_:1}),u.value.start_time?(s(),i("div",Ke,v(u.value.start_time),1)):d("",!0)]),_:1}),o(p,{class:"align-items-center form-group mb-5"}),o(p,{class:"align-items-center form-group"},{default:n(()=>[o(t,{cols:"12",lg:"4"},{default:n(()=>[o(b,{label:"Contact Name:","label-for":"input-1"},{default:n(()=>[o(f,{type:"text",class:"form-control",id:"contactname",modelValue:r.value.contact_name,"onUpdate:modelValue":e[16]||(e[16]=l=>r.value.contact_name=l)},null,8,["modelValue"]),u.value.contact_name?(s(),i("div",Xe,v(u.value.contact_name),1)):d("",!0)]),_:1})]),_:1}),o(t,{cols:"12",lg:"4",class:"mb-sm-3 mb-md-3 mb-lg-0"},{default:n(()=>[o(b,{label:"Phone Number:","label-for":"input-1"},{default:n(()=>[o(f,{type:"text",id:"addphonenumber",modelValue:r.value.mobile_number,"onUpdate:modelValue":e[17]||(e[17]=l=>r.value.mobile_number=l),class:"form-control"},null,8,["modelValue"]),u.value.mobile_number?(s(),i("div",Ze,v(u.value.mobile_number),1)):d("",!0)]),_:1})]),_:1}),o(t,{cols:"12",lg:"4"},{default:n(()=>[o(b,{label:"Email:","label-for":"input-1"},{default:n(()=>[o(f,{type:"text",id:"addemail",modelValue:r.value.email_address,"onUpdate:modelValue":e[18]||(e[18]=l=>r.value.email_address=l),class:"form-control",placeholder:"email"},null,8,["modelValue"])]),_:1}),u.value.email_address?(s(),i("div",Qe,v(u.value.email_address),1)):d("",!0)]),_:1})]),_:1}),o(p,{class:"g-3 align-items-center form-group"},{default:n(()=>[o(t,{cols:"12",lg:"12",class:"mb-sm-3 mb-md-3 mb-lg-0"},{default:n(()=>[o(b,{label:"Description:","label-for":"input-1"},{default:n(()=>[Z(c("textarea",{type:"text",id:"description","onUpdate:modelValue":e[19]||(e[19]=l=>r.value.description=l),class:"form-control",rows:"3",placeholder:"description"},null,512),[[Ce,r.value.description]]),u.value.description?(s(),i("div",ea,v(u.value.description),1)):d("",!0)]),_:1})]),_:1})]),_:1}),o(p,{class:"align-items-center form-group"},{default:n(()=>[o(Ae,{onNewAttendee:ce}),u.value.attendees?(s(),i("div",aa,v(u.value.attendees),1)):d("",!0)]),_:1})])])])]),c("div",ta,[I.value===!1?(s(),i("button",{key:0,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",name:"save",onClick:de},"Submit")):(s(),i("button",la,e[27]||(e[27]=[c("span",{class:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"},null,-1),Ve(" Loading... ")])))])]),_:1})}}},ia={__name:"BookMeetingView",setup(Q){return(q,M)=>(s(),w(oa))}};export{ia as default};
