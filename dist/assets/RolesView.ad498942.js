import{A as te,j as r,z as oe,y as le,q as ae,r as p,o as d,c as u,d as l,w as s,b as t,e as k,m as se,D as ne,F as A,C as B,G as M,t as g,n as E,p as re}from"./index.e0205fad.js";import{_ as ie}from"./RolePermissions.f4885c96.js";import"./pdfjs.7adb8c57.js";const de={class:"d-flex justify-content-end"},ue={class:"d-flex justify-content-between"},ce={class:"d-flex align-items-center"},me=["value"],ve={class:"d-flex align-items-center"},pe={class:"table-responsive"},fe={class:"table table-hover"},ye=["onClick"],_e=["onClick"],be={key:1},ge={"aria-label":"Page navigation"},we={class:"pagination justify-content-end"},he=["disabled"],ke=["onClick"],Pe=["disabled"],Ce={class:"mb-3"},xe={key:0,class:"error","aria-live":"polite"},$e={class:"mb-3"},Ae={key:0,class:"error","aria-live":"polite"},Re={class:"d-flex justify-content-end"},Me={__name:"RolesView",setup(De){const P=te(),{proxy:m}=re(),I=r("asc"),C=r(""),y=r(""),c=r(1),x=r(1),R=r(20),O=r([20,50]),$=r(null),T={name:"",description:""},_=r({...T}),U=()=>{_.value={...T.value}},b=r([]),v=r({}),q=()=>{v.value={}},w=r(null),z=()=>{q(),U()},F=()=>{$.value&&$.value.show()},D=a=>{a>0&&a<=x.value&&(c.value=a,f(a))},G=async()=>{var a;w.value=null;try{const e=await P.post("v1/iam/rbac/role",_.value);e.data.alertifyPayload?(w.value=e.data.alertifyPayload,$.value.hide(),f(),m.$showAlert({title:w.value.theme,icon:w.value.theme,text:w.value.message,timer:4e3,showConfirmButton:!1,showCancelButton:!1})):m.$showToast({title:"Appointment Deleted successfully",icon:"success"})}catch(e){v.value=e.response.data.errorPayload.errors;const n=((a=e.response.data.errorPayload.errors)==null?void 0:a.message)||e.response.errorPayload.message||"An unknown error occurred";m.$showToast({title:"An error occurred",text:n,icon:"error"})}},f=async(a=c.value)=>{try{const e=await P.get(`/v1/iam/rbac/roles?page=${a}&per-page=${R.value}&_q=${y.value}`);b.value=Object.values(e.data.dataPayload.data),console.log(b.value)}catch(e){console.error(e)}};oe(y,()=>{y.value===""?f():Q()});const j=r(null),V=r(""),H=a=>{V.value=a,console.log("1",V.value),j.value.$refs.roleModal.show()},K=le(()=>[...b.value].sort((a,e)=>{let n=I.value==="asc"?1:-1;return a[C.value]<e[C.value]?-1*n:a[C.value]>e[C.value]?1*n:0})),L=async()=>{await f(1)},Q=async()=>{var a;try{const e=await P.get(`v1/auth/manage-role?_q=${y.value}`);b.value=Object.values(e.data.dataPayload.data)}catch(e){v.value=e.response.data.errorPayload.errors;const n=((a=e.response.data.errorPayload.errors)==null?void 0:a.message)||e.response.errorPayload.message||"An unknown error occurred";m.$showToast({title:"An error occurred",text:n,icon:"error"})}},Y=async a=>{var n;if((await m.$showAlert({title:"Delete Role",text:"Are you sure you want to delete this role?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete",cancelButtonText:"No, cancel"})).isConfirmed)try{const i=await P.delete(`v1/auth/role/${a}`);i.data.alertifyPayload?(m.$showAlert({title:i.data.alertifyPayload.theme,icon:i.data.alertifyPayload.theme,text:i.data.alertifyPayload.message,timer:4e3,showConfirmButton:!1,showCancelButton:!1}),f()):m.$showToast({title:"Role Deleted successfully",icon:"success"})}catch(i){v.value=i.response.data.errorPayload.errors;const h=((n=i.response.data.errorPayload.errors)==null?void 0:n.message)||i.response.errorPayload.message||"An unknown error occurred";m.$showToast({title:"An error occurred",text:h,icon:"error"})}};return ae(()=>{f()}),(a,e)=>{const n=p("b-col"),i=p("b-button"),h=p("b-row"),N=p("b-form-input"),J=p("b-input-group-append"),W=p("b-input-group"),X=p("b-card"),Z=p("b-modal");return d(),u(A,null,[l(n,{lg:"12"},{default:s(()=>[l(X,null,{default:s(()=>[l(h,{class:"mb-5"},{default:s(()=>[l(n,{lg:"6"},{default:s(()=>e[8]||(e[8]=[t("div",null,[t("h2",null,"Roles")],-1)])),_:1}),l(n,{lg:"6"},{default:s(()=>[t("div",de,[l(i,{variant:"primary",onClick:F},{default:s(()=>e[9]||(e[9]=[k(" New Role ")])),_:1})])]),_:1})]),_:1}),l(h,{class:"mb-3"},{default:s(()=>[l(n,{lg:"12"},{default:s(()=>[t("div",ue,[t("div",ce,[se(t("select",{id:"itemsPerPage","onUpdate:modelValue":e[0]||(e[0]=o=>R.value=o),onChange:L,class:"form-select form-select-sm"},[(d(!0),u(A,null,B(O.value,o=>(d(),u("option",{key:o,value:o},g(o),9,me))),128))],544),[[ne,R.value]])]),t("div",ve,[l(W,null,{default:s(()=>[l(N,{placeholder:"Search...",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=o=>y.value=o)},null,8,["modelValue"]),l(J,null,{default:s(()=>[l(i,{variant:"primary",onClick:e[2]||(e[2]=o=>f(1))},{default:s(()=>e[10]||(e[10]=[k("Search")])),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1}),t("div",pe,[t("table",fe,[t("thead",null,[t("tr",null,[t("th",{onClick:e[3]||(e[3]=o=>a.sortTable("start_date"))},e[11]||(e[11]=[k("Role Name "),t("i",{class:"fas fa-sort"},null,-1)])),e[12]||(e[12]=t("th",null,"Description",-1)),e[13]||(e[13]=t("th",null,"Actions",-1))])]),t("tbody",null,[Array.isArray(b.value)&&b.value.length>0?(d(!0),u(A,{key:0},B(K.value,(o,S)=>(d(),u("tr",{key:S},[t("td",null,g(o.name),1),t("td",null,g(o.description),1),t("td",null,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm me-3",onClick:ee=>H(o.name)},e[14]||(e[14]=[t("i",{class:"fa-solid fa-shield",style:{color:"#076232"}},null,-1)]),8,ye),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:ee=>Y(o.name)},e[15]||(e[15]=[t("i",{class:"fa-solid fa-trash"},null,-1)]),8,_e)])]))),128)):(d(),u("tr",be,e[16]||(e[16]=[t("td",{colspan:"6",class:"text-center"},"No records found.",-1)])))])])]),l(n,{sm:"12",lg:"12",class:"mt-5 d-flex justify-content-end mb-n5"},{default:s(()=>[t("nav",ge,[t("ul",we,[t("li",{class:M(["page-item",{disabled:c.value===1}])},[t("button",{class:"page-link",onClick:e[4]||(e[4]=o=>D(c.value-1)),disabled:c.value===1},"Previous",8,he)],2),(d(!0),u(A,null,B(x.value,o=>(d(),u("li",{key:o,class:M(["page-item",{active:c.value===o}])},[t("button",{class:"page-link",onClick:S=>D(o)},g(o),9,ke)],2))),128)),t("li",{class:M(["page-item",{disabled:c.value===x.value}])},[t("button",{class:"page-link",onClick:e[5]||(e[5]=o=>D(c.value+1)),disabled:c.value===x.value},"Next",8,Pe)],2)])])]),_:1})]),_:1})]),_:1}),l(Z,{ref_key:"AddRole",ref:$,title:"Add Role",class:"my-modal taller-modal modal-fullscreen","no-close-on-esc":"",size:"xl","hide-footer":"",centered:"","hide-header-close":"false",onHide:z},{"modal-header":s(({close:o})=>[e[18]||(e[18]=t("h5",{class:"modal-title"},"Add Role",-1)),l(i,{variant:"light",onClick:o,class:"close"},{default:s(()=>e[17]||(e[17]=[k(" \xD7 ")])),_:2},1032,["onClick"])]),default:s(()=>[l(h,null,{default:s(()=>[l(n,{md:"12",lg:"6"},{default:s(()=>[t("div",Ce,[e[19]||(e[19]=t("label",{for:"startDatePicker",class:"form-label"},"Role Name",-1)),l(N,{modelValue:_.value.name,"onUpdate:modelValue":e[6]||(e[6]=o=>_.value.name=o),id:"startDatePicker",type:"text",placeholder:"Enter Role Name"},null,8,["modelValue"])]),v.value.name?(d(),u("div",xe,g(v.value.name),1)):E("",!0)]),_:1}),l(n,{md:"12",lg:"6"},{default:s(()=>[t("div",$e,[e[20]||(e[20]=t("label",{for:"roledescription",class:"form-label"},"Description",-1)),l(N,{modelValue:_.value.description,"onUpdate:modelValue":e[7]||(e[7]=o=>_.value.description=o),id:"roledescription",type:"text",placeholder:"Enter description"},null,8,["modelValue"])]),v.value.description?(d(),u("div",Ae,g(v.value.description),1)):E("",!0)]),_:1})]),_:1}),t("div",Re,[l(i,{onClick:G,variant:"primary"},{default:s(()=>e[21]||(e[21]=[k("Save")])),_:1})])]),_:1},512),l(ie,{ref_key:"roleModal",ref:j,roleName:V.value},null,8,["roleName"])],64)}}};export{Me as default};
