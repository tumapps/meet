import{A as Y,j as n,z as D,q as Z,r as ee,o as u,g as se,w as ae,b as o,m as G,v as H,c,F as A,C as q,G as z,t as B,n as te,p as oe}from"./index.e0205fad.js";const le={class:"row",style:{"max-height":"70vh",display:"flex",overflow:"hidden"}},ne={class:"col-md-5 border p-3",style:{"min-height":"80%","overflow-y":"auto","max-height":"67vh"}},ie={class:"mb-3"},re={class:"list-group"},de=["onClick"],ue={key:0},ce={class:"mt-3"},ve={class:"list-group mt-2"},me=["onClick"],pe={class:"col-md-2 d-flex flex-column justify-content-center align-items-center",style:{position:"sticky",top:"0",height:"70vh","background-color":"white","z-index":"10"}},ye=["disabled"],ge=["disabled"],he={class:"col-md-5 border p-3",style:{"min-height":"80%","overflow-y":"auto","max-height":"67vh"}},_e={class:"mb-3"},be={class:"list-group mt-2"},fe=["onClick"],Pe={class:"mt-3"},ke={class:"list-group mt-2"},xe=["onClick"],$e={__name:"RolePermissions",props:{roleName:{type:String,required:!1},user_id:{type:Number,required:!1},username:{type:String,required:!1}},setup(L){const y=Y(),{proxy:v}=oe(),U=n({}),p=n({}),m=n({}),g=n([]),h=n([]),_=n([]),$=n(""),C=n(""),l=L,i=n({permissions:[]}),O=()=>{U.value={},p.value={},m.value={},g.value=[],h.value=[],_.value=[],i.value={permissions:[]},S.value="",N.value=""},S=n(""),V=n(""),N=n(""),J=()=>{N.value=n(l.roleName),l.user_id&&l.roleName?(S.value=`/v1/iam/user/assign/${l.user_id}`,V.value=`/v1/iam/user/revoke/${l.user_id}`,M()):l.roleName&&(S.value=`/v1/iam/auth/assign?role=${l.roleName}`,V.value=`/v1/iam/auth/remove?id=${l.roleName}`,R())},K=()=>{O(),C.value="",$.value=""},Q=n(null);D(()=>l.roleName,l.user_id,(s,a,r,e)=>{N.value=s,s!==a&&!l.user_id&&R(),r!==e&&l.user_id&&M()});const R=async()=>{const s=await y.get(`/v1/iam/auth/manage-role?id=${l.roleName}`);m.value=s.data.dataPayload.data.available.roles,g.value=s.data.dataPayload.data.available.permissions,_.value=s.data.dataPayload.data.assigned.permissions,h.value=s.data.dataPayload.data.assigned.roles},T=s=>{if(i.value.permissions.includes(s)){i.value.permissions=i.value.permissions.filter(a=>a!==s);return}i.value.permissions.push(s)},I=s=>i.value.permissions.includes(s.name),M=async()=>{const s=await y.get(`/v1/iam/manage-user-roles/${l.user_id}`);m.value=s.data.dataPayload.data.available.roles,g.value=s.data.dataPayload.data.available.permissions,_.value=s.data.dataPayload.data.assigned.permissions,h.value=s.data.dataPayload.data.assigned.roles},W=async()=>{var s,a,r,e,d,b,f,P,k,x;try{const t=await y.post(S.value,i.value);l.user_id?l.user_id&&M():R(),i.value.permissions=[],t.data.alertifyPayload?(p.value=t.data.alertifyPayload,v.$showToast({title:p.value.message||"Success",icon:p.value.theme||"success"})):v.$showToast({title:"Success",icon:"success"})}catch(t){const w=((e=(r=(a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.errorPayload)==null?void 0:r.errors)==null?void 0:e.message)||((f=(b=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:b.alertifyPayload)==null?void 0:f.message),j=((x=(k=(P=t==null?void 0:t.response)==null?void 0:P.data)==null?void 0:k.alertifyPayload)==null?void 0:x.theme)||"error";v.$showToast({title:w,text:w,icon:j})}},X=async()=>{var s,a,r,e,d,b,f,P,k,x;try{const t=await y.post(V.value,i.value);i.value.permissions=[],l.user_id?l.user_id&&M():R(),t.data.alertifyPayload?(p.value=t.data.alertifyPayload,v.$showToast({title:p.value.message||"success",icon:"success"})):v.$showToast({title:"success",icon:"success"})}catch(t){const w=((e=(r=(a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.errorPayload)==null?void 0:r.errors)==null?void 0:e.message)||((f=(b=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:b.alertifyPayload)==null?void 0:f.message),j=((x=(k=(P=t==null?void 0:t.response)==null?void 0:P.data)==null?void 0:k.alertifyPayload)==null?void 0:x.theme)||"error";v.$showToast({title:w,text:w,icon:j})}},F=n("");D(()=>$.value,s=>{E(l.roleName,s)}),D(()=>C.value,s=>{F.value="assinged",E(l.roleName,s)});const E=async(s,a)=>{var r;try{const e=await y.get(`v1/auth/manage-role?id=${s}&_q=${a}`);F.value==="assinged"?(h.value=e.data.dataPayload.data.assigned.roles,_.value=e.data.dataPayload.data.assigned.permissions):(m.value=e.data.dataPayload.data.available.roles,g.value=e.data.dataPayload.data.available.permissions)}catch(e){U.value=e.response.data.errorPayload.errors;const d=((r=e.response.data.errorPayload.errors)==null?void 0:r.message)||e.response.errorPayload.message||"An unknown error occurred";v.$showToast({title:"An error occurred",text:d,icon:"error"})}};return Z(()=>{}),(s,a)=>{const r=ee("b-modal");return u(),se(r,{ref_key:"roleModal",ref:Q,onShow:J,title:N.value,class:"modal-fullscreen modal rounded-3","no-close-on-backdrop":"","no-close-on-esc":"",size:"xl","hide-footer":"",onHide:K},{default:ae(()=>[o("div",le,[o("div",ne,[a[5]||(a[5]=o("h5",null,"Available Items",-1)),o("div",ie,[G(o("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>$.value=e),placeholder:"Search Roles or Permissions..."},null,512),[[H,$.value]])]),o("div",null,[a[3]||(a[3]=o("button",{class:"btn btn-link text-decoration-none"},"Roles",-1)),o("ul",re,[(u(!0),c(A,null,q(m.value,e=>(u(),c("li",{key:e.name,class:z(["list-group-item",I(e,"role","available")?"active-item":""]),onClick:d=>T(e.name)},B(e.name),11,de))),128))]),!m.value||Object.keys(m.value).length===0?(u(),c("div",ue,"No roles available")):te("",!0)]),o("div",ce,[a[4]||(a[4]=o("button",{class:"btn btn-link text-decoration-none"},"Permissions",-1)),o("ul",ve,[(u(!0),c(A,null,q(g.value,e=>(u(),c("li",{key:e.name,class:z(["list-group-item",I(e,"permissions","available")?"active-item":""]),onClick:d=>T(e.name)},B(e.data),11,me))),128))])])]),o("div",pe,[o("button",{class:"btn btn-primary mb-2",onClick:W,disabled:i.value.permissions.length===0},">>",8,ye),o("button",{class:"btn btn-danger",onClick:X,disabled:i.value.permissions.length===0},"<<",8,ge)]),o("div",he,[a[7]||(a[7]=o("h5",null,"Assigned Items",-1)),o("div",_e,[G(o("input",{type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e),placeholder:"Search Assigned Roles or Permissions..."},null,512),[[H,C.value]])]),o("div",null,[o("button",{class:"btn btn-link text-decoration-none",onClick:a[2]||(a[2]=e=>s.toggleCollapse("assignedRoles"))},"Roles"),o("ul",be,[(u(!0),c(A,null,q(h.value,e=>(u(),c("li",{key:e.name,class:z(["list-group-item",I(e,"roles","assigned")?"active-item":""]),onClick:d=>T(e.name)},B(e.name),11,fe))),128))])]),o("div",Pe,[a[6]||(a[6]=o("button",{class:"btn btn-link text-decoration-none"},"Permissions",-1)),o("ul",ke,[(u(!0),c(A,null,q(_.value,e=>(u(),c("li",{key:e.name,class:z(["list-group-item",I(e,"permissions","assigned")?"active-item":""]),onClick:d=>T(e.name)},B(e.data),11,xe))),128))])])])])]),_:1},8,["title"])}}};export{$e as _};
