import{_ as ke,i as Ce,h as c,A as he,C as we,s as Ae,r as _,o as n,c as u,d as s,w as l,b as t,e as y,k as Pe,x as $e,F as B,y as O,l as f,z as L,t as m,f as xe,m as Se,G as De}from"./index.91d534ba.js";import{_ as Te,T as Ee}from"./BookAppointment.70bd2665.js";import"./component.0be391dc.js";const Ve={class:"d-flex justify-content-end"},Be={class:"d-flex justify-content-between"},Le={class:"d-flex align-items-center"},Ne=["value"],Me={class:"d-flex align-items-center"},Ie={class:"table-responsive"},je={class:"table table-hover"},Ue={key:0},Oe={key:0},Re={key:0,class:"form-check form-switch"},Ye=["checked","onChange"],Fe=["for"],ze={key:1,class:"form-check form-switch"},Ge=["onClick"],Ke=["onClick"],Qe=["onClick"],qe=["onClick"],He={key:4,class:"btn btn-outline-exclamation-circle btn-sm"},Je={key:1},We={"aria-label":"Page navigation"},Xe={class:"pagination justify-content-end"},Ze=["disabled"],et=["onClick"],tt=["disabled"],at={key:0,class:"error"},ot={key:0,class:"error"},st={key:0,class:"error"},lt={key:0,class:"error"},nt={key:0,class:"error"},rt={key:0,class:"error"},ut={id:"status-badge",class:"d-flex align-items-center"},dt={key:0},it={key:0},ct={key:1},pt={class:"d-flex justify-content-center"},mt={__name:"Appointments",setup(vt){const R=Ce(),N=c("");N.value=R.getCanBeBooked();const Y=c(null),b=c(""),G=()=>{Y.value.$refs.appointmentModal.show()},{proxy:d}=Se(),C=he(),$=c([]),A=c(""),D=c("asc"),K=c(!1),g=c(1),x=c(1),Q=c(20),F=c(20),q=c([10,20,50,100]),M=c(""),v=c({contact_name:"",email_address:"",mobile_number:"",appointment_date:"",start_time:"",end_time:"",subject:"",appointment_type:"",status:"",created_at:"",updated_at:""}),H=R.getUserId(),p=c({appointment_date:"",start_time:"",end_time:"",contact_name:"",email_address:"",mobile_number:"",subject:"",appointment_type:"",status:"",created_at:"",updated_at:"",statusLabel:"",user_id:H}),I=a=>{a>0&&a<=x.value&&(g.value=a,k(a))},J=async()=>{g.value=1,await k(1)},W=a=>{T.value=a},X=a=>{appointmentData.value.start_time=(a==null?void 0:a.startTime)||"",appointmentData.value.end_time=(a==null?void 0:a.endTime)||""},P=a=>{A.value===a?D.value=D.value==="asc"?"desc":"asc":(A.value=a,D.value="asc")},Z=a=>{switch(a){case"Reschedule":return"warning";case"Active":return"success";case"Cancelled":return"warning";case"Deleted":return"danger";default:return"secondary"}},ee=we(()=>[...$.value].sort((a,e)=>{let i=D.value==="asc"?1:-1;return a[A.value]<e[A.value]?-1*i:a[A.value]>e[A.value]?1*i:0}));Ae(async()=>{k(1)});const te=a=>{h.value=a,d.$showAlert({title:"Are you sure?",text:"You are about to Delete this appointment. Do you want to proceed?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Delete it!",cancelButtonText:"No, keep it",confirmButtonColor:"#d33",cancelButtonColor:"#076232"}).then(e=>{e.isConfirmed&&(se(a),k(1))})},ae=a=>{h.value=a,d.$showAlert({title:"Are you sure?",text:"You are about to CANCEL this appointment. Do you want to proceed?",icon:"warning",input:"textarea",inputLabel:"Reason for Cancellation",inputPlaceholder:"Please type your reason here...",inputAttributes:{"aria-label":"Please type your reason here"},showCancelButton:!0,confirmButtonText:"Yes, CANCEL it!",cancelButtonText:"No, keep it",confirmButtonColor:"#d33",cancelButtonColor:"#097B3E",preConfirm:e=>e||(d.$showAlert({title:"Ooops!",text:"You need to provide a reason for cancellation.",icon:"info"}),!1)}).then(e=>{if(e.isConfirmed){const i=e.value;oe(a,i),k(1)}})},oe=async(a,e)=>{try{const i=await C.put(`v1/scheduler/cancel/${a}`,{cancellation_reason:e});S(a),k(1),b.value=i.data.toastPayload,d.$showToast({title:b.value.toastMessage||"Appointment Deleted successfully2",icon:"success"})}catch{d.$showToast({title:"An error occurred ",text:"Ooops! an error occured ",icon:"error"})}},se=async a=>{var e;b.value=null;try{const i=await C.delete(`v1/scheduler/appointments/${a}`);S(a),k(1),i.data.toastPayload?(b.value=i.data.toastPayload,d.$showToast({title:b.value.toastMessage||"Appointment Deleted successfully",icon:"success"})):d.$showToast({title:"Appointment Deleted successfully",icon:"success"})}catch{const r=((e=response.data.errorPayload.errors)==null?void 0:e.message)||errorPayload.message||"An unknown error occurred";d.$showToast({title:"An error occurred",text:r,icon:"error"})}};c("");const le=async a=>{var e,i;b.value={};try{const r=await C.delete(`v1/scheduler/appointments/${a}`);S(a),k(1),r.data.toastPayload?(b.value=r.data.toastPayload,d.$showToast({title:b.value.toastMessage||"Appointment Restored successfully",icon:"success"})):d.$showToast({title:"Appointment restored successfully",icon:"success"})}catch(r){console.error("Error restoring appointment:",r),d.$showToast({title:"An error occurred",text:((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.error)||"An unknown error occurred",icon:"error"})}},ne=a=>{h.value=a,d.$showAlert({title:"Are you sure?",text:"You are about to RESTORE thirestoreAppointments appointment. Do you want to proceed?",icon:"warning",showCancelButton:!0,confirmButtonText:"RESTORE",cancelButtonText:"No, keep it",confirmButtonColor:"#d33",cancelButtonColor:"#076232"}).then(e=>{e.isConfirmed&&(le(a),k(1))})},k=async(a=1)=>{try{const e=await C.get("v1/scheduler/appointments?page=${page}&perPage=${selectedPerPage.value}");K.value=Array.isArray(e.data),$.value=e.data.dataPayload.data,g.value=e.data.dataPayload.currentPage,x.value=e.data.dataPayload.totalPages,Q.value=e.data.dataPayload.perPage}catch{d.$showToast({title:"An error occurred ",text:"Ooops! an error occured!",icon:"error"})}},S=async a=>{try{v.value={};const e=await C.get(`/v1/scheduler/appointments/${a}`);e.data.dataPayload&&!e.data.errorPayload&&(p.value=e.data.dataPayload.data,p.value.created_at=De.convertToDate(p.value.created_at),h.value=a)}catch(e){e.response&&e.response.data&&e.response.data.enprrorPayload?v.value=e.response.data.errorPayload.errors:v.value={general:"An unexpected error occurred."}}},h=c(""),re=a=>{const e=d.$refs.myModal;S(a),h.value=a,e.show()},ue=async()=>{try{v.value={};const a=await C.put(`/v1/scheduler/appointments/${h.value}`,p.value);a.data.toastPayload?(b.value=a.data.toastPayload,d.$showToast({title:b.value.toastMessage||"Appointment Updated successfully",icon:"success"})):d.$showToast({title:"Appointment Updated successfully",icon:"success"})}catch(a){a.response&&a.response.data.errorPayload?v.value=a.response.data.errorPayload.errors:d.$showAlert({title:"Failed",text:"It seems there was an error updating your appointment. Please try again!",icon:"error"})}},de=async()=>{try{const a=await C.get(`v1/scheduler/appointments?_search=${M.value}`);$.value=a.data.dataPayload.data}catch{d.$showToast({title:"An error occurred ",text:"Ooops! an error occured",icon:"error"})}};c([]),c("");const j=c([]),U=c(""),T=c([]),ie=async a=>{try{a=h.value,v.value={};const e=await C.get(`/v1/scheduler/slot-suggestion/${a}`);j.value=e.data.dataPayload.data.suggestions,U.value=j.value.date,T.value=j.value.slots,e.data.toastPayload?(b.value=e.data.toastPayload,d.$showToast({title:b.value.toastMessage||"success",icon:"success"})):d.$showToast({title:"Operation successful",icon:"success"}),p.value.appointment_date=U}catch(e){v.value=e.response.data.errorPayload.errors,d.$showAlert({title:"Failed",text:"An error occurred",icon:"error"})}},ce=async a=>{try{const e=await C.put(`/v1/scheduler/checkin/${a}`);S(a),k(1),e.data.toastPayload?(b.value=e.data.toastPayload,d.$showToast({title:b.value.toastMessage||"Appointment Checked In successfully",icon:"success"})):d.$showToast({title:"Appointment Checked In successfully",icon:"success"})}catch(e){let i="An error occurred";if(e.response&&e.response.data.errorPayload){const r=e.response.data.errorPayload.errors;r&&r.message&&(i=r.message)}d.$showToast({title:i,text:i,icon:"error"})}};return(a,e)=>{const i=_("b-button"),r=_("b-col"),w=_("b-form-input"),pe=_("b-input-group-append"),me=_("b-input-group"),E=_("b-row"),ve=_("b-card"),fe=_("b-badge"),be=_("b-form-group"),_e=_("b-form"),ye=_("b-card-body"),ge=_("b-modal");return n(),u(B,null,[s(r,{lg:"12"},{default:l(()=>[s(ve,null,{default:l(()=>[e[34]||(e[34]=t("div",null,[t("h2",null,"Appointments")],-1)),s(E,{class:"mb-3"},{default:l(()=>[s(r,{lg:"12",md:"12",sm:"12",class:"mb-3"},{default:l(()=>[t("div",Ve,[s(i,{variant:"primary",onClick:G},{default:l(()=>e[16]||(e[16]=[y(" New Appointment ")])),_:1})])]),_:1}),s(r,{lg:"12",md:"12",sm:"12"},{default:l(()=>[t("div",Be,[t("div",Le,[Pe(t("select",{id:"itemsPerPage","onUpdate:modelValue":e[0]||(e[0]=o=>F.value=o),onChange:J,class:"form-select form-select-sm",style:{width:"auto"}},[(n(!0),u(B,null,O(q.value,o=>(n(),u("option",{key:o,value:o},m(o),9,Ne))),128))],544),[[$e,F.value]])]),t("div",Me,[s(me,null,{default:l(()=>[s(w,{placeholder:"Search...","aria-label":"Search",modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=o=>M.value=o)},null,8,["modelValue"]),s(pe,null,{default:l(()=>[s(i,{variant:"primary",onClick:de},{default:l(()=>e[17]||(e[17]=[y(" Search ")])),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1}),t("div",Ie,[t("table",je,[t("thead",null,[t("tr",null,[t("th",{onClick:e[2]||(e[2]=o=>P("contact_name"))},e[18]||(e[18]=[y(" Name "),t("i",{class:"fas fa-sort"},null,-1)])),t("th",{onClick:e[3]||(e[3]=o=>P("mobile_number"))},e[19]||(e[19]=[y(" Contact "),t("i",{class:"fas fa-sort"},null,-1)])),t("th",{onClick:e[4]||(e[4]=o=>P("appointment_date"))},e[20]||(e[20]=[y(" Date "),t("i",{class:"fas fa-sort"},null,-1)])),t("th",{onClick:e[5]||(e[5]=o=>P("start_time"))},e[21]||(e[21]=[y(" Subject "),t("i",{class:"fas fa-sort"},null,-1)])),t("th",{onClick:e[6]||(e[6]=o=>P("email_address"))},e[22]||(e[22]=[y(" Email "),t("i",{class:"fas fa-sort"},null,-1)])),t("th",{onClick:e[7]||(e[7]=o=>P("start_time"))},e[23]||(e[23]=[y(" Time "),t("i",{class:"fas fa-sort"},null,-1)])),N.value===0?(n(),u("th",Ue," Recipient ")):f("",!0),e[24]||(e[24]=t("th",null," Status ",-1)),e[25]||(e[25]=t("th",null," Checked In ",-1)),e[26]||(e[26]=t("th",null," Actions ",-1))])]),t("tbody",null,[Array.isArray($.value)&&$.value.length>0?(n(!0),u(B,{key:0},O(ee.value,(o,z)=>(n(),u("tr",{key:z},[t("td",null,m(o.contact_name),1),t("td",null,m(o.mobile_number),1),t("td",null,m(o.appointment_date),1),t("td",null,m(o.subject),1),t("td",null,m(o.email_address),1),t("td",null,m(o.start_time)+" - "+m(o.end_time),1),N.value===0?(n(),u("td",Oe,m(o.userName),1)):f("",!0),t("td",null,[t("span",{class:L("badge bg-"+o.recordStatus.theme)},m(o.recordStatus.label),3)]),t("td",null,[o.recordStatus.label==="ACTIVE"?(n(),u("div",Re,[t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckChecked-{{ item.id }}",checked:o.checked_in===1,onChange:V=>ce(o.id)},null,40,Ye),t("label",{class:"form-check-label",for:"flexSwitchCheckChecked-"+o.id},m(o.checked_in===1?"Checked In":"Check In"),9,Fe)])):f("",!0),o.recordStatus.label!=="ACTIVE"?(n(),u("div",ze,e[27]||(e[27]=[t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDisabled",checked:"",disabled:""},null,-1)]))):f("",!0)]),t("td",null,[o.recordStatus.label!=="DELETED"&&o.recordStatus.label!=="CANCELLED"?(n(),u("button",{key:0,class:"btn btn-outline-primary btn-sm me-3",onClick:V=>re(o.id)},e[28]||(e[28]=[t("i",{class:"fas fa-edit",title:"Edit"},null,-1)]),8,Ge)):f("",!0),o.recordStatus.label!=="DELETED"&&o.recordStatus.label!=="CANCELLED"?(n(),u("button",{key:1,class:"btn btn-outline-warning btn-sm me-3",onClick:V=>ae(o.id)},e[29]||(e[29]=[t("i",{class:"fas fa-cancel",title:"Cancel"},null,-1)]),8,Ke)):f("",!0),o.recordStatus.label!=="DELETED"&&o.recordStatus.label!=="CANCELLED"?(n(),u("button",{key:2,class:"btn btn-outline-danger btn-sm me-3",onClick:V=>te(o.id)},e[30]||(e[30]=[t("i",{class:"fas fa-trash",title:"Delete"},null,-1)]),8,Qe)):f("",!0),o.recordStatus.label==="DELETED"?(n(),u("button",{key:3,class:"btn btn-outline-danger btn-sm",onClick:V=>ne(o.id)},e[31]||(e[31]=[t("i",{class:"fas fa-undo",title:"Restore"},null,-1)]),8,qe)):f("",!0),o.recordStatus.label==="CANCELLED"?(n(),u("button",He,e[32]||(e[32]=[t("i",{class:"fas fa-undo",title:"appointment has been cancelled no further action can be done"},null,-1)]))):f("",!0)])]))),128)):(n(),u("tr",Je,e[33]||(e[33]=[t("td",{colspan:"5",class:"text-center"}," No data to display ",-1)])))])])]),s(r,{sm:"12",lg:"12",md:"12",class:"d-flex justify-content-end mt-5 mb-n5"},{default:l(()=>[t("nav",We,[t("ul",Xe,[t("li",{class:L(["page-item",{disabled:g.value===1}])},[t("button",{class:"page-link",onClick:e[8]||(e[8]=o=>I(g.value-1)),disabled:g.value===1},"Previous",8,Ze)],2),(n(!0),u(B,null,O(x.value,o=>(n(),u("li",{key:o,class:L(["page-item",{active:g.value===o}])},[t("button",{class:"page-link",onClick:z=>I(o)},m(o),9,et)],2))),128)),t("li",{class:L(["page-item",{disabled:g.value===x.value}])},[t("button",{class:"page-link",onClick:e[9]||(e[9]=o=>I(g.value+1)),disabled:g.value===x.value},"Next",8,tt)],2)])])]),_:1})]),_:1})]),_:1}),s(Te,{ref_key:"appointmentModal",ref:Y},null,512),s(ge,{ref:"myModal","hide-footer":"",title:"Appointment Details",size:"xl"},{default:l(()=>[s(E,{class:"justify-content-center"},{default:l(()=>[s(r,{lg:"12",sm:"12"},{default:l(()=>[s(ye,null,{default:l(()=>[s(_e,null,{default:l(()=>[s(be,null,{default:l(()=>[s(E,null,{default:l(()=>[s(r,{lg:"12",md:"12",class:"mb-3"},{default:l(()=>[e[35]||(e[35]=t("label",{for:"input-107",class:"form-label"},"Date",-1)),s(w,{modelValue:p.value.appointment_date,"onUpdate:modelValue":e[10]||(e[10]=o=>p.value.appointment_date=o),id:"input-107",type:"date"},null,8,["modelValue"]),v.value.appointment_date?(n(),u("div",at,m(v.value.appointment_date),1)):f("",!0)]),_:1}),s(r,{lg:"6",md:"6",class:"mb-3"},{default:l(()=>[e[36]||(e[36]=t("label",{for:"input-107",class:"form-label"},"Start Time",-1)),s(w,{modelValue:p.value.start_time,"onUpdate:modelValue":e[11]||(e[11]=o=>p.value.start_time=o),id:"input-107"},null,8,["modelValue"]),v.value.start_time?(n(),u("div",ot,m(v.value.start_time),1)):f("",!0)]),_:1}),s(r,{lg:"6",md:"6",class:"mb-3"},{default:l(()=>[e[37]||(e[37]=t("label",{for:"input-107",class:"form-label"},"End Time",-1)),s(w,{modelValue:p.value.end_time,"onUpdate:modelValue":e[12]||(e[12]=o=>p.value.end_time=o),id:"input-107"},null,8,["modelValue"]),v.value.end_time?(n(),u("div",st,m(v.value.end_time),1)):f("",!0)]),_:1}),s(r,{lg:"12",md:"12",class:"mb-3"},{default:l(()=>[e[38]||(e[38]=t("label",{for:"input-107",class:"form-label"},"Subject",-1)),s(w,{modelValue:p.value.subject,"onUpdate:modelValue":e[13]||(e[13]=o=>p.value.subject=o),id:"input-107"},null,8,["modelValue"]),v.value.subject?(n(),u("div",lt,m(v.value.subject),1)):f("",!0)]),_:1}),s(r,{lg:"12",md:"12",class:"mb-3"},{default:l(()=>[e[39]||(e[39]=t("label",{for:"input-107",class:"form-label"},"Appointment Type",-1)),s(w,{modelValue:p.value.appointment_type,"onUpdate:modelValue":e[14]||(e[14]=o=>p.value.appointment_type=o),id:"input-107"},null,8,["modelValue"]),v.value.appointment_type?(n(),u("div",nt,m(v.value.appointment_type),1)):f("",!0)]),_:1}),s(r,{lg:"12",md:"12",class:"mb-3"},{default:l(()=>[e[40]||(e[40]=t("label",{for:"input-107",class:"form-label"},"Booked on",-1)),s(w,{modelValue:p.value.created_at,"onUpdate:modelValue":e[15]||(e[15]=o=>p.value.created_at=o),id:"input-107"},null,8,["modelValue"]),v.value.created_at?(n(),u("div",rt,m(v.value.created_at),1)):f("",!0)]),_:1}),s(r,{lg:"8",md:"8",class:"mb-3"},{default:l(()=>[e[42]||(e[42]=t("label",{for:"status-badge",class:"form-label"},"Status",-1)),t("div",ut,[s(fe,{variant:Z(p.value.statusLabel),class:"me-3"},{default:l(()=>[y(m(p.value.statusLabel),1)]),_:1},8,["variant"]),p.value.status===3?(n(),xe(i,{key:0,variant:"success",onClick:ie},{default:l(()=>e[41]||(e[41]=[y("Suggest Open slots")])),_:1})):f("",!0)])]),_:1}),s(r,{lg:"5",class:"mb-3"},{default:l(()=>[p.value.status===3?(n(),u("div",dt,[T.value.length>1?(n(),u("div",it,[t("h3",null,m(U.value),1),t("div",null,[s(Ee,{timeSlots:T.value,"onUpdate:timeSlots":W,onSelectedSlotsTimes:X},null,8,["timeSlots"])])])):(n(),u("div",ct,e[43]||(e[43]=[t("p",null,"No available slots.",-1)])))])):f("",!0)]),_:1}),s(E,{class:"m-5"},{default:l(()=>[s(r,null,{default:l(()=>[t("div",pt,[s(i,{variant:"primary",class:"me-1",onClick:ue},{default:l(()=>e[44]||(e[44]=[y("Update")])),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)],64)}}};var yt=ke(mt,[["__scopeId","data-v-076fd0ce"]]);export{yt as default};
